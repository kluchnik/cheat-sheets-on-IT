# Утилиты для работы с BIOS

| Наименование утилиты | Описание |
|-|-|
| flashrom | Прошивка EEPROM (https://www.flashrom.org/Flashrom) |
| AMI MMTool | (AMI) Распаковщик. Инструмент для работы с модулями AMI BIOS |
| AMI Flash Utility | (AMI) Прошивальщик |
| AMIBCP | (AMI) Редактор |
| AWDFLASH | Прошивальщик |
| Uniflash | Прошивальщик для BIOS, BIOS видеокарт, flash микросхем в сетевых картах |
| Phoenix Phlash | (Phoenix) Прошивальщик |
| WinPhlash | (Phoenix) Прошивальщик |
| Phoenix BIOS Editor | (Phoenix) Редактор |
| PhoenixDeco | (Phoenix) Распаковщик |
| Aptio V | Утилита для работы с модулями AMI BIOS |
| iCHLogo | (Intel NUC) Заменить образ логотипа Intel по умолчанию на специальный |
| iFlashV | (Intel NUC) Загрузка BIOS, обновление logo, добавление ключей активации OEM |
| iDmiEdit | (Intel NUC) Заменить строки, связанные с таблицами SMBIOS |
| iSetupCfg | (Intel NUC) Обновление переменных NVRAM |

## flashrom

### Создание резервной копии BIOS:
```
flashrom -p internal -Vr bios.bak
```
Если необходимо указать модель чипсета необходимо вызвать команду:
```
flashrom -p internal -с 'модель_чипсета' -Vr bios-модель_чипсета.bak
```
, если будет ошибка необходимо добавить
```
-iich:BIOS
```

### Восстановление BIOS:
```
flashrom -p internal -Vw bios.bak
```
Если необходимо указать модель чипсета необходимо вызвать команду:
```
flashrom -p internal -с 'модель_чипсета' -Vw bios-модель_чипсета.bak 
```
**ВАЖНО!** Если на этапе снятия копии копировался только регион BIOS, т.е. использовался агрумент -i (```-i ich:BIOS```), то при восстановлении также необходимо указывать регион.  
Если для восстановления используется внешний spi программатор, необходимо составить **карту регионов** и указать её flashrom параметром аргумента -l  
```
-l chip.lay
```
Формат карты регионов:  
```
<reg_start>:<reg_end> <reg_name>
00500000:007fffff bios
```
Пример вызова flashrom с использованием внешнего программатора:
```
flashrom -p ft2232_spi:type=2232h:divisor=4 -l mychip.lay -i bios -w bios.bak
```

## AWDFLASH

Самый популярный, но не самый лучший. Запускать с ключиками:  

```
AWDFLASH v8.64 (12/14) (C)Phoenix Technologies Ltd. 2005 All Rights Reserved

Usage:  AWDFLASH [FileName1] [FileName2] [/<sw>[/<sw>...]]
     FileName1 : New BIOS Name For Flash Programming
     FileName2 : BIOS File For Backing-up the Original BIOS
 <Swtches>    ?: Show Help Messages
  py: Program Flash Memory               pn: No Flash Programming
  sy: Backup Original BIOS To Disk File  sn: No Original BIOS Backup
  Sb: Skip BootBlock programming         Wb: Always Programming BootBlock
  cd: Clear DMI Data After Programming   cc: Clear CMOS Data After Programming
  cp: Clear PnP(ESCD) Data After Programming
  LD: Destroy CMOS Checksum And No System Halt For First Reboot
      After Programming                Tiny: Occupy lesser memory
  QI: Qualify flash part number with source file
   E: Return to DOS After Programming     R: RESET System After Programming
   F: Use Flash Routines in Original BIOS For Flash Programming
 cks: Show update Binfile checksum  cksXXXX: Compare Binfile CheckSum with XXXX

NVMAC:XXXXXXXXXXXX                   NVGUID:XXXXXXXXXXXXXX
      Support nForce Input MAC,GUID Function,with "/wb" to update MAC and GUID.

Example: AWDFLASH 6A69R000.bin /py/sn/nvmac:xxxxxxxxxxxx/wb
```
```awdflash имя_прошивки /cd/cp/py/sn/f/r```

В этом случае биос перешьётся без лишних вопросов (/py - Program=Y, /sn - Save=No, /f - не проверять от той ли платы это биос и биос ли это вообще:) и после окончания прошивки комп сразу перезагрузится (ключик /r - Reset, ежели не нужно - не писать). Ключи /cd/cp (Clear DMI, Clear PNP) настоятельно рекомендуются к ним можно добавить автоматический сброс CMOS (по умолчанию) - /cc. Если прошиваем не award bios (например ami), используем ещё и ключик nab: Work with not Award BIOS.  

/F - Программировать средствами системного BIOS. Большинство современных BIOS содержат процедуры записи FlashROM. Используя ключ /F, программа AwardFlash программирует FlashROM алгоритмами, которые находятся в текущей версии BIOS. Если материнская плата выполнена с такими конструктивными особенностями, что использование алгоритмов Award Flash Writer не приводит к успешному результату, следует воспользоваться ключом /F.  
Данный ключик очень важный и при установке влияет на принципиальные вещи:  
> Не проводятся проверки на совпадение BIOS ID прошиваемого файла и текущей прошивки
> Не делаются проверки на совпадение BIOS_Lock фичи (для относительно новых систем)
> Да и, вообще, не проверяется - Award-овский ли это биос

LD - (от Low Destroy) - Загрузиться после перезагрузки с "заводскими" значениями СMOS и при этом без остановки по F1.  
Ключик с первого взгляда похож на /сс (ClearCMOS). И смысл, в принципе, аналогичен - "поломать" значения в CMOS, чтобы свежепрошитый биос был вынужден загрузить значения по умолчанию и не зависнуть, если в новой версии изменится назначение каких-то ячеек CMOS-памяти.  
Однако в реальности он является "комплиментарным" (к /сс) - или чистим весь CMOS или лишь нарушаем ему CRC. В случае чистки (/сс) - забиваются FF-ками все ячейки с 10h по 7Fh. В случае же /LD - изменяются лишь ячейки 10h (записывается DDh), 11h (записывается CCh) и 12h (записывается BBh), что и приводет к нарушению CRC. Кроме того, второй бит ячейки 11h сбрасывается в 0, а он отвечает за то, оставливаться ли, если в процессе POST были ошибки (в том числе полученная неправильная CRC) - предлагая либо нажать DEL и войти в BIOS Setup либо нажать F1 для дальнейшей загрузки с значениями по умолчанию.  

QI - (от Qualify ID) - Проверить BIOS ID прошивки и биоса.  
Если нужно строго "не промахнуться" и прошить именно "тот" биос - можно использовать этот ключик, который сверяет BIOS ID файла прошивки с текущим в биосе и откажется прошивать при несовпадении.  
Однако на практике не раз возникают случаи, когда даже "совершенно официальная" новая версия "почему-то" не проходит успешно подобную проверку, в результате чего полностью "доверять" данному ключу нельзя. Кроме того, как и многие другие ключи, при установке /f - он игнорируется. Потому рекомендовать его можно больше лишь для написания собственных бат-файлов, где будет возможность задать "строгую проверку".  

ab - (от Not AwardBIOS) - Не AwardBIOS.  
Ключик, четко дающий понять прошивальщику - работаем не с AwardBIOS. В результате, понятно, пропускаются всяческие проверки, характерные только для AwardBIOS-файлов. Практической ценности данный ключик в свете намного более "правильного" /f - не представляет. Потому сфера применения - хитрые бат-файлы для энтузиастов-любителей.  

unm - (от Use Not Match size images for flash) - Не учитывать несовпадения объемов биоса и прошивки.  
Данный ключ заставляет прошивальщик не учитывать факт несовпадения размера файла прошивки и прошиваемого биоса. Может оказаться крайне полезным в случаях, когда под рукой окажется микросхема большей мегабитности (объема), чем "родная". Потому рекомендуется помнить и применять в таких (например, нужно прошить 2Мбит-ную, а есть только 4Мбит-ные аналоги) ситуациях.  

bb - (от BIOS + BIOS ) - Поддержка дуал-биосных систем.  
При использовании этого ключика - автоматически "включается" и /f.  

mac1:XXXXXXXXXXXX - (от Set MAC-address) - Задать MAC-адрес (интегрированной в чипсет) сетевой карты.  

## AMIFLASH

Не такой популярный как awdflash, но в отличие от оного - самый лучший.  

```amiflash имя_прошивки /b /n /-o /-c /-d /-r /v /-i /-k /-e /-g```

Если нужно сохранить старый биос, запускать с ключиками:  
```amiflash /b /n /-o /-c /-d /-r /v /-i /-k /-e /-g/sимя_прошивки```
! После ключика /s - пробела быть не должно  
