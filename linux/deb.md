# Сборка deb-пакета

## Создание deb-пакета из команды ```make install```

Создание deb-пакета из команды ```make install``` можно создать с использованием утилиты [CheckInstall](http://www.asic-linux.com.mx/~izto/checkinstall/).

CheckInstall поддерживает:  
* скрипты, выполняющиеся до и после установки пакета
* автоматическое управление конфигурационными файлами: пакет не позволит затереть старые конфиги новыми без спроса
* работа с шаблонами: возможность задавать пользователю вопросы при установке
* изменение файлов других пакетов

## Создание кастомного deb-пакета

[Debian Policy Manual](https://www.debian.org/doc/debian-policy/)

### 1. Утснаовка зависимотей
```
$ sudo apt-get install dpkg debconf debhelper lintian
```
### 2. Подготовка директории
```
$ mkdir ~/mydeb
$ mkdir -p ~/mydeb/DEBIAN
```
### 3. Создание необходимой структуры каталогов и файлов
Данная структура будет применена после установки пакета
```
$ mkdir -p ~/mydeb/home/user
$ echo 'test file' > ~/mydeb/home/user/test.txt
```
```
$ tree ~/mydeb/

~/mydeb/
├── DEBIAN
└── home
    └── user
        └── test.txt
```
### 4. Создание метаинформация для deb-пакета
#### Описание файлов:
| Имя файла | Описание | Обязательный |
| - | - | - |
| ```DEBIAN/control``` | Центральный файл пакета, который описывает все основные свойства deb-пакета | + |
| ```DEBIAN/copyright``` | Текст лицензии | - |
| ```DEBIAN/changelog``` | История изменений, данную информацию использует dpkg для получения номера версии, ревизии, дистрибутива и важности пакета. [Дополнительная информация](http://www.debian.org/doc/debian-policy/ch-source.html#s-dpkgchangelog) | - |
| ```DEBIAN/rules``` | Правила компиляции, используется когда в файле ```DEBIAN/control``` параметру ```Architeture``` задано значение ```source```. [Дополнительная информация](http://www.debian.org/doc/debian-policy/ch-source.html#s-debianrules) | - |
| ```DEBIAN/conffiles``` | Список файлов конфигурации. В данном файле указывается список файлов которые будут заменять файлы при установки. Если в текущей версии пакета один из этих файлов обновляется, то пользователь получает предупреждение о конфликте версий конфигов, и может выбрать: удалить, заменить, или сделать merge | - |
| ```DEBIAN/dirs``` | Список папок для создания. В данном файле рекомендуется указать все папки которые необходимы для deb-пакета | - |
| ```DEBIAN/menu``` | Создание пунктов меню. Дополнительная информация: ```man5 menufile```. Примеры меню есть в ```/usr/share/applications``` файлы ```*.desktop``` | - |
| ```DEBIAN/md5sums``` | Контрольные суммы файлов. Используется для проверки целостности пакета. Важный файл. Заполняется так: ```$ md5deep -r usr > DEBIAN/md5sums``` | - |
| ```DEBIAN/watch``` | Мониторинг сайта, откуда была скачена прога. Файл содержит инструкции для программ ```uscan``` и ```uupdate```. [Дополнительная информация](http://dehs.alioth.debian.org/) | - |
| ```DEBIAN/cron.d``` | Инсталляция заданий cron. Файл содержит чать crontab для инсталляции | - |
| ```DEBIAN/inid.d``` | init-скрипт | - |
| ```DEBIAN/preinst``` | Выполняется перед установкой пакета: он может подготовить что-либо для успешной установки. [Дополнительная ифнормация](http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html#s-mscriptsinstact) | - |
| ```DEBIAN/postinst``` | Выполняется сразу после установки пакета: он настраивает установленный пакет так, чтоб он был готов к работе. Здесь также выполняется интерактивная конфигурация пакета: это делается при помощи ```dh_input``` и файла ```DEBIAN/templates```. [Дополнительная ифнормация](http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html#s-mscriptsinstact) | - |
| ```DEBIAN/prerm``` | Выполняется непосредственно перед удалением пакета: обычно этот скрипт подчищает установочные пути пакета. [Дополнительная ифнормация](http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html#s-mscriptsinstact) | - |
| ```DEBIAN/postrm``` | Выполняется сразу после удаления пакета: вычищает остатки. [Дополнительная ифнормация](http://www.debian.org/doc/debian-policy/ch-maintainerscripts.html#s-mscriptsinstact) | - |
| ```DEBIAN/templates``` | Шаблоны для диалогов, который содержит данные, используемые при выводе диалоговых окон (GUI или ncurses) | - |
| ```DEBIAN/config``` | Скрипт через который можно задавать пользователю вопросы: ввести строку, выбрать один из вариантов, поставить галочку и пр. Этим занимается библиотека ```bash``` функций ```debhelper``` пакета ```debconf``` | - |

#### Файл ```DEBIAN/control```
**Основная информация о deb-пакете**
| Атрибут | Класс | Описание | Пример |
| - | - | - | - |
|  |  |  |  |


